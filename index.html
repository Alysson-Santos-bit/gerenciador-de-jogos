<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meus Jogos (Na Nuvem ‚òÅÔ∏è)</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* O DESIGN CONTINUA O MESMO (Bonito e Limpo) */
        body { font-family: 'Roboto', sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; color: #333; }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        .card-formulario { background: white; max-width: 500px; margin: 0 auto 40px auto; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .inputs-group { display: flex; flex-direction: column; gap: 15px; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; transition: 0.3s; }
        input:focus { border-color: #3498db; outline: none; box-shadow: 0 0 5px rgba(52, 152, 219, 0.3); }
        button { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; transition: transform 0.1s; }
        button:active { transform: scale(0.98); }
        #btn-salvar { background-color: #27ae60; color: white; width: 100%; margin-top: 10px; }
        #btn-cancelar { background-color: #95a5a6; color: white; width: 100%; display: none; }
        .btn-editar { background-color: #f39c12; color: white; }
        .btn-deletar { background-color: #e74c3c; color: white; }
        #lista-jogos { list-style: none; padding: 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; max-width: 1000px; margin: 0 auto; }
        #lista-jogos li { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; flex-direction: column; justify-content: space-between; border-left: 5px solid #3498db; }
        .jogo-info { margin-bottom: 15px; }
        .jogo-titulo { font-size: 18px; font-weight: bold; display: block; margin-bottom: 5px; }
        .jogo-detalhes { color: #7f8c8d; font-size: 14px; }
        .acoes { display: flex; gap: 10px; justify-content: flex-end; }
        /* Aviso de carregando */
        #loading { text-align: center; color: #7f8c8d; font-style: italic; display: none; }
    </style>
</head>
<body>

    <h1>üéÆ Gerenciador Cloud (Firebase)</h1>

    <div class="card-formulario">
        <h3 id="titulo-formulario" style="margin-top:0">Novo Jogo</h3>
        <div class="inputs-group">
            <input type="text" id="titulo" placeholder="Nome do Jogo">
            <input type="number" id="ano" placeholder="Ano">
            <input type="number" id="preco" placeholder="Pre√ßo">
            <button id="btn-salvar">SALVAR NA NUVEM</button>
            <button id="btn-cancelar">CANCELAR</button>
        </div>
    </div>

    <p id="loading">Carregando dados da nuvem...</p>
    <ul id="lista-jogos"></ul>

    <script type="module">
        // 1. IMPORTAR AS BIBLIOTECAS DO GOOGLE
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // 2. SUAS CHAVES (Colei as que voc√™ me mandou)
        const firebaseConfig = {
            apiKey: "AIzaSyCZoIsCavuVM3odtrabUB9GAkaNugbXrfQ",
            authDomain: "meus-jogos-cloud.firebaseapp.com",
            projectId: "meus-jogos-cloud",
            storageBucket: "meus-jogos-cloud.firebasestorage.app",
            messagingSenderId: "274825808238",
            appId: "1:274825808238:web:5b8fdd5755120889fa197f"
        };

        // 3. INICIAR O BANCO DE DADOS
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app); // 'db' √© a nossa conex√£o com a nuvem

        // Vari√°veis Globais
        let idEdicao = null;
        let jogosGlobais = []; // Guarda a c√≥pia local para facilitar a edi√ß√£o

        // --- FUN√á√ïES DO SISTEMA ---

        // A. CARREGAR (LER DA NUVEM)
        async function carregarJogos() {
            document.getElementById("loading").style.display = "block"; // Mostra "Carregando..."
            const listaHTML = document.getElementById("lista-jogos");
            listaHTML.innerHTML = "";

            try {
                // Vai na cole√ß√£o 'jogos' e pega tudo
                const querySnapshot = await getDocs(collection(db, "jogos"));
                
                jogosGlobais = []; // Limpa a mem√≥ria local

                querySnapshot.forEach((doc) => {
                    // O Firebase separa o ID (doc.id) dos Dados (doc.data())
                    const jogo = { id: doc.id, ...doc.data() };
                    jogosGlobais.push(jogo);

                    // Desenha na tela
                    listaHTML.innerHTML += `
                        <li>
                            <div class="jogo-info">
                                <span class="jogo-titulo">${jogo.titulo}</span>
                                <span class="jogo-detalhes">${jogo.ano} ‚Ä¢ R$ ${jogo.preco},00</span>
                            </div>
                            <div class="acoes">
                                <button class="btn-editar" data-id="${jogo.id}">EDITAR</button>
                                <button class="btn-deletar" data-id="${jogo.id}">EXCLUIR</button>
                            </div>
                        </li>
                    `;
                });

                // RECONECTAR OS BOT√ïES (Necess√°rio porque type="module" isola o c√≥digo)
                adicionarEventosBotoes();

            } catch (erro) {
                console.error("Erro ao carregar:", erro);
                alert("Erro ao conectar no Google. Veja o console.");
            } finally {
                document.getElementById("loading").style.display = "none"; // Esconde "Carregando..."
            }
        }

        // B. SALVAR (CRIAR OU ATUALIZAR)
        async function salvarJogo() {
            const titulo = document.getElementById("titulo").value;
            const ano = document.getElementById("ano").value;
            const preco = document.getElementById("preco").value;
            const btnSalvar = document.getElementById("btn-salvar");

            if(!titulo || !ano || !preco) return alert("Preencha tudo!");

            btnSalvar.innerText = "SALVANDO...";
            btnSalvar.disabled = true; // Trava o bot√£o para n√£o clicar 2x

            try {
                if (idEdicao === null) {
                    // MODO CRIAR (addDoc gera ID autom√°tico do Google)
                    await addDoc(collection(db, "jogos"), {
                        titulo: titulo,
                        ano: Number(ano),
                        preco: Number(preco)
                    });
                } else {
                    // MODO EDITAR (updateDoc precisa do ID espec√≠fico)
                    const jogoRef = doc(db, "jogos", idEdicao);
                    await updateDoc(jogoRef, {
                        titulo: titulo,
                        ano: Number(ano),
                        preco: Number(preco)
                    });
                }

                cancelarEdicao(); // Limpa form
                carregarJogos();  // Atualiza a lista

            } catch (e) {
                console.error("Erro ao salvar: ", e);
                alert("Erro ao salvar!");
            } finally {
                btnSalvar.disabled = false; // Destrava o bot√£o
            }
        }

        // C. DELETAR
        async function deletarJogo(id) {
            if(confirm("Tem certeza que quer apagar do servidor?")) {
                try {
                    await deleteDoc(doc(db, "jogos", id));
                    carregarJogos();
                } catch (e) {
                    alert("Erro ao deletar");
                }
            }
        }

        // D. EDITAR (Preenche o formul√°rio)
        function prepararEdicao(id) {
            const jogo = jogosGlobais.find(j => j.id === id);
            if(jogo) {
                document.getElementById("titulo").value = jogo.titulo;
                document.getElementById("ano").value = jogo.ano;
                document.getElementById("preco").value = jogo.preco;
                
                idEdicao = id;
                document.getElementById("titulo-formulario").innerText = "Editando Jogo";
                const btn = document.getElementById("btn-salvar");
                btn.innerText = "ATUALIZAR NUVEM";
                btn.style.backgroundColor = "#f39c12";
                document.getElementById("btn-cancelar").style.display = "block";
            }
        }

        function cancelarEdicao() {
            idEdicao = null;
            document.getElementById("titulo").value = "";
            document.getElementById("ano").value = "";
            document.getElementById("preco").value = "";
            
            document.getElementById("titulo-formulario").innerText = "Novo Jogo";
            const btn = document.getElementById("btn-salvar");
            btn.innerText = "SALVAR NA NUVEM";
            btn.style.backgroundColor = "#27ae60";
            document.getElementById("btn-cancelar").style.display = "none";
        }

        // --- SISTEMA DE EVENTOS (Necess√°rio para Modules) ---
        // Como usamos type="module", as fun√ß√µes n√£o s√£o globais. 
        // Precisamos adicionar os cliques manualmente.

        document.getElementById("btn-salvar").addEventListener("click", salvarJogo);
        document.getElementById("btn-cancelar").addEventListener("click", cancelarEdicao);

        function adicionarEventosBotoes() {
            // Pega todos os bot√µes de Editar
            document.querySelectorAll(".btn-editar").forEach(btn => {
                btn.addEventListener("click", (e) => prepararEdicao(e.target.dataset.id));
            });
            // Pega todos os bot√µes de Deletar
            document.querySelectorAll(".btn-deletar").forEach(btn => {
                btn.addEventListener("click", (e) => deletarJogo(e.target.dataset.id));
            });
        }

        // Iniciar
        carregarJogos();
    </script>
</body>
</html>